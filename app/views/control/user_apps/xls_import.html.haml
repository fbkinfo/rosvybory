
- if @many_apps.added_count > 0
  %h2 Успешно загруженные пользователи (#{@many_apps.added_count})
  %table
    %thead
      %tr
        %th= User.human_attribute_name(:id)
        %th= User.human_attribute_name(:created_at)
        %th= User.human_attribute_name(:full_name)
        %th= User.human_attribute_name(:adm_region)
        %th= User.human_attribute_name(:region)
        %th= User.human_attribute_name(:phone)
        %th= User.human_attribute_name(:email)
        %th= User.human_attribute_name(:uic)
        %th= User.human_attribute_name(:current_roles)
        %th= User.human_attribute_name(:previous_statuses)
        %th= User.human_attribute_name(:experience_count)
        %th= User.human_attribute_name(:legal_status)
        %th= User.human_attribute_name(:has_video)
        %th= User.human_attribute_name(:desired_statuses)
        %th= User.human_attribute_name(:extra)
    %tbody
      - @many_apps.user_apps.select(&:persisted?).each do |euar|
        -if euar.user
          - user = euar.user.decorate
          %tr
            %td= user.organisation_with_user_id
            %td= user.created_at && l(user.created_at)
            %td= link_to user.full_name, [:control, euar.user]
            %td= user.adm_region
            %td= user.region
            %td= user.phone
            %td= user.email
            %td= user.uic
            %td= user.human_current_roles
            %td= user.human_previous_statuses
            %td= user.experience_count
            %td= user.human_legal_status
            %td= user.human_has_video
            %td= euar.desired_statuses
            %td= user.extra

= form_for @many_apps, as: :many_apps, url: process_xls_control_user_apps_path, method: :post do |f|

  - if @many_apps.fail_count == 1 && @many_apps.added_count == 0
    %h2 Выберите файл
    %fieldset
      = f.label :file
      = f.file_field :file

      = label_tag :replace_existing
      = check_box_tag :replace_existing
    %h2 Или скопируйте строки из Excel
  - elsif @many_apps.fail_count > 0
    %h2 Эти данные не удалось сохранить

  - if @many_apps.fail_count > 0
    %table.many-new
      %thead
        %tr
          - ExcelUserAppRow.column_names.each do |i|
            %th
              = ExcelUserAppRow.human_attribute_name(i)
      %tbody
        = f.fields_for :user_apps, f.object.user_apps.reject(&:persisted?) do |uaf|
          = render 'xls_fields', :f => uaf

    %div
      = link_to_add_association 'Добавить заявку', f, :user_apps, :partial => 'xls_fields', :data => {:association_insertion_node => 'table.many-new tbody', :association_insertion_method => 'append'}

    .actions
      = f.submit 'Загрузить'
  - else
    .actions
      К списку
      = link_to 'пользователей', [:control, :users]

